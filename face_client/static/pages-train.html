<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="description" content="Responsive Admin & Dashboard Bootstrap 5">
	<meta name="author" content="Dung Anh Tran">
	<meta name="keywords" content="contactless-checking, bootstrap, bootstrap 5, admin, dashboard, template, responsive, css, sass, html, theme, front-end, ui kit, web">

	<link rel="preconnect" href="https://fonts.gstatic.com">
	<link rel="shortcut icon" href="img/icons/icon-48x48.png" />

	<title>Jenkins Pipeline | Contactless Checking</title>

	<link href="css/app.css" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>

<body>
	<div class="wrapper">
		<nav id="sidebar" class="sidebar js-sidebar">
			<div class="sidebar-content js-simplebar">
				<a class="sidebar-brand" href="index.html">
					<span class="align-middle">Contactless Checking</span>
				</a>

				<ul class="sidebar-nav">
					<li class="sidebar-header">Pages</li>
					<li class="sidebar-item"><a class="sidebar-link" href="index.html"><i class="align-middle" data-feather="sliders"></i> <span class="align-middle">Dashboard</span></a></li>
					<li class="sidebar-item"><a class="sidebar-link" href="pages-profile.html"><i class="align-middle" data-feather="user"></i> <span class="align-middle">Profile</span></a></li>
					<li class="sidebar-item"><a class="sidebar-link" href="pages-detection.html"><i class="align-middle" data-feather="book"></i> <span class="align-middle">Detection</span></a></li>
					<li class="sidebar-item"><a class="sidebar-link" href="pages-customer.html"><i class="align-middle" data-feather="user"></i> <span class="align-middle">Customer</span></a></li>
                    <li class="sidebar-item active"><a class="sidebar-link" href="pages-train.html"><i class="align-middle" data-feather="box"></i> <span class="align-middle">Train</span></a></li>
				</ul>
			</div>
		</nav>

		<div class="main">
			<nav class="navbar navbar-expand navbar-light navbar-bg">
				<a class="sidebar-toggle js-sidebar-toggle"><i class="hamburger align-self-center"></i></a>
				<div class="navbar-collapse collapse">
					<ul class="navbar-nav navbar-align">
						<li class="nav-item dropdown"><a class="nav-icon dropdown-toggle" href="#" id="alertsDropdown" data-bs-toggle="dropdown"><div class="position-relative"><i class="align-middle" data-feather="bell"></i><span class="indicator">4</span></div></a><div class="dropdown-menu dropdown-menu-lg dropdown-menu-end py-0" aria-labelledby="alertsDropdown"><div class="dropdown-menu-header"><span id="notification-count">0</span> New Notifications</div><div class="list-group" id="notification-list"><!-- Dynamic notifications will be inserted here --></div><div class="dropdown-menu-footer"><a href="#" class="text-muted">Show all notifications</a></div></div></li>
						<li class="nav-item dropdown"><a class="nav-icon dropdown-toggle d-inline-block d-sm-none" href="#" data-bs-toggle="dropdown"><i class="align-middle" data-feather="settings"></i></a><a class="nav-link dropdown-toggle d-none d-sm-inline-block" href="#" data-bs-toggle="dropdown"><img class="avatar img-fluid rounded me-1" alt="User Avatar" id="navbarProfilePicture" /><span class="text-dark" id="navbarUserName">User Name</span></a><div class="dropdown-menu dropdown-menu-end"><a class="dropdown-item" href="pages-profile.html"><i class="align-middle me-1" data-feather="user"></i> Profile</a><a class="dropdown-item" href="#"><i class="align-middle me-1" data-feather="pie-chart"></i> Analytics</a><div class="dropdown-divider"></div><a class="dropdown-item" href="index.html"><i class="align-middle me-1" data-feather="settings"></i> Settings & Privacy</a><a class="dropdown-item" href="#"><i class="align-middle me-1" data-feather="help-circle"></i> Help Center</a><div class="dropdown-divider"></div><a class="dropdown-item" id="logout-link" href="#">Log out</a></div></li>
					</ul>
				</div>
			</nav>

			<main class="content">
                <div class="container-fluid p-0">
                    <h1 class="h3 mb-3"><strong>Jenkins Pipeline Configuration</strong></h1>
                    <div class="row">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-body">
                                    <form id="jenkinsForm">
                                        <div class="form-row align-items-center mb-2">
                                            <label for="jenkinsUrl" class="col-2 col-form-label">Jenkins URL</label>
                                            <input type="text" id="jenkinsUrl" class="form-control col-8 mr-2" name="jenkinsUrl" placeholder="http://172.20.90.52:8080" value="http://172.20.90.52:8080" required>
                                        </div>
                                        <div class="form-row align-items-center mb-2">
                                            <label for="jobName" class="col-2 col-form-label">Job Name</label>
                                            <input type="text" id="jobName" class="form-control col-8 mr-2" name="jobName" placeholder="your-job-name" value="checking-train" required>
                                        </div>
                                        <div class="form-row align-items-center mb-2">
                                            <label for="jobName" class="col-2 col-form-label">User Name</label>
                                            <input type="text" id="userName" class="form-control col-8 mr-2" name="userName" placeholder="your-user-name" value="checking" required>
                                        </div>
                                        <div class="form-row align-items-center mb-2">
                                            <label for="jobName" class="col-2 col-form-label">API Token</label>
                                            <input type="text" id="apiToken" class="form-control col-8 mr-2" name="apiToken" placeholder="your-api-token" required>
                                        </div>
                                        <div id="formGroupsContainer">
                                            <div class="form-row align-items-center mb-2">
                                                <select class="form-control col-2 mr-2">
                                                    <option>Variable</option>
                                                </select>
                                                <input type="text" class="form-control col-4 mr-2" name="variableKey[]" placeholder="Key" value="MODE">
                                                <input type="text" class="form-control col-4 mr-2" name="variableValue[]" placeholder="Value" value="train">
                                                <span class="remove-btn col-1" onclick="removeFormGroup(this)">×</span>
                                            </div>
                                            <div class="form-row align-items-center mb-2">
                                                <select class="form-control col-2 mr-2">
                                                    <option>Variable</option>
                                                </select>
                                                <input type="text" class="form-control col-4 mr-2" name="variableKey[]" placeholder="Key" value="NUM_EPOCHS">
                                                <input type="text" class="form-control col-4 mr-2" name="variableValue[]" placeholder="Value" value="100">
                                                <span class="remove-btn col-1" onclick="removeFormGroup(this)">×</span>
                                            </div>
                                            <div class="form-row align-items-center mb-2">
                                                <select class="form-control col-2 mr-2">
                                                    <option>Variable</option>
                                                </select>
                                                <input type="text" class="form-control col-4 mr-2" name="variableKey[]" placeholder="Key" value="LEARNING_RATE">
                                                <input type="text" class="form-control col-4 mr-2" name="variableValue[]" placeholder="Value" value="0.001">
                                                <span class="remove-btn col-1" onclick="removeFormGroup(this)">×</span>
                                            </div>
                                            <div class="form-row align-items-center mb-2">
                                                <select class="form-control col-2 mr-2">
                                                    <option>Variable</option>
                                                </select>
                                                <input type="text" class="form-control col-4 mr-2" name="variableKey[]" placeholder="Key" value="MOMENTUM">
                                                <input type="text" class="form-control col-4 mr-2" name="variableValue[]" placeholder="Value" value="0.9">
                                                <span class="remove-btn col-1" onclick="removeFormGroup(this)">×</span>
                                            </div>
                                            <div class="form-row align-items-center mb-2">
                                                <select class="form-control col-2 mr-2">
                                                    <option>Variable</option>
                                                </select>
                                                <input type="text" class="form-control col-4 mr-2" name="variableKey[]" placeholder="Key" value="CONTINUE_TRAINING">
                                                <input type="text" class="form-control col-4 mr-2" name="variableValue[]" placeholder="Value" value="true">
                                                <span class="remove-btn col-1" onclick="removeFormGroup(this)">×</span>
                                            </div>
                                            <div class="form-row align-items-center mb-2">
                                                <select class="form-control col-2 mr-2">
                                                    <option>Variable</option>
                                                </select>
                                                <input type="text" class="form-control col-4 mr-2" name="variableKey[]" placeholder="Key" value="IS_UPLOAD">
                                                <input type="text" class="form-control col-4 mr-2" name="variableValue[]" placeholder="Value" value="true">
                                                <span class="remove-btn col-1" onclick="removeFormGroup(this)">×</span>
                                            </div>
                                        </div>
                                        <button type="button" class="btn btn-primary mr-2" onclick="addFormGroup()">Add Form Group</button>
                                        <button type="button" class="btn btn-primary" onclick="runPipeline()">Run Pipeline</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
            
			<footer class="footer">
				<div class="container-fluid">
					<div class="row text-muted">
						<div class="col-6 text-start">
							<p class="mb-0"><a class="text-muted" href="https://github.com/anhdung2k1/contactless-checking" target="_blank"><strong>Contactless Checking</strong></a> - <a class="text-muted" href="https://github.com/anhdung2k1/contactless-checking" target="_blank"><strong>Dung Anh Tran</strong></a> &copy;</p>
						</div>
						<div class="col-6 text-end">
							<ul class="list-inline">
								<li class="list-inline-item"><a class="text-muted" href="https://github.com/anhdung2k1/contactless-checking" target="_blank">Support</a></li>
								<li class="list-inline-item"><a class="text-muted" href="https://github.com/anhdung2k1/contactless-checking" target="_blank">Help Center</a></li>
								<li class="list-inline-item"><a class="text-muted" href="https://github.com/anhdung2k1/contactless-checking" target="_blank">Privacy</a></li>
								<li class="list-inline-item"><a class="text-muted" href="https://github.com/anhdung2k1/contactless-checking" target="_blank">Terms</a></li>
							</ul>
						</div>
					</div>
				</div>
			</footer>
		</div>
	</div>
	<script src="js/actions/config.js"></script>
	<script src="js/app.js"></script>
	<script src="js/actions/logout.js"></script>
	<script src="js/actions/navUser.js"></script>
	<script src="js/actions/notifications.js"></script>
    <script>
        const MODEL_URL = window.config.MODEL_URL;
        function addFormGroup() {
            const container = document.getElementById('formGroupsContainer');
            const newGroup = document.createElement('div');
            newGroup.className = 'form-row align-items-center mb-2';
    
            const select = document.createElement('select');
            select.className = 'form-control col-2 mr-2';
            select.innerHTML = '<option>Variable</option>';
            newGroup.appendChild(select);
    
            const inputKey = document.createElement('input');
            inputKey.type = 'text';
            inputKey.className = 'form-control col-4 mr-2';
            inputKey.name = 'variableKey[]';
            inputKey.placeholder = 'Key';
            newGroup.appendChild(inputKey);
    
            const inputValue = document.createElement('input');
            inputValue.type = 'text';
            inputValue.className = 'form-control col-4 mr-2';
            inputValue.name = 'variableValue[]';
            inputValue.placeholder = 'Value';
            newGroup.appendChild(inputValue);
    
            const removeBtn = document.createElement('span');
            removeBtn.className = 'remove-btn col-1';
            removeBtn.innerText = '×';
            removeBtn.onclick = function() {
                removeFormGroup(removeBtn);
            };
            newGroup.appendChild(removeBtn);
    
            container.appendChild(newGroup);
        }
    
        function removeFormGroup(element) {
            const container = document.getElementById('formGroupsContainer');
            container.removeChild(element.parentNode);
        }
    
        function runPipeline() {
            const form = document.getElementById('jenkinsForm');
            const formData = new FormData(form);
            const data = {};
            formData.forEach((value, key) => {
                if (key.endsWith('[]')) {
                    const baseKey = key.slice(0, -2);
                    if (!data[baseKey]) {
                        data[baseKey] = [];
                    }
                    data[baseKey].push(value);
                } else {
                    data[key] = value;
                }
            });
            console.log('Pipeline data:', JSON.stringify(data));

            fetch(`${MODEL_URL}/model/train`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok ' + response.statusText);
                }
                return response.json();
            })
            .catch(error => console.error('Error:', error));
            
            fetch(`${HOST_IP}/api/jenkins/buildWithParameters`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${TOKEN}`
                },
                body: JSON.stringify(data)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok ' + response.statusText);
                }
                return response.json();
            })
            .then(data => {
                console.log('Status: ', data.status)
                console.log('Message: ', data.message)
                alert(`${data.status}`)
            })
            .catch(error => console.error('Error:', error));
        }
    </script>
</body>

</html>
